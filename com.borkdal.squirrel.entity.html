<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>com.borkdal.squirrel.entity documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Squirrel 0.1.0 API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>com</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>borkdal</span></div></div></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>squirrel</span></div></div></li><li class="depth-4 branch"><a href="com.borkdal.squirrel.definitions.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>definitions</span></div></a></li><li class="depth-4 branch current"><a href="com.borkdal.squirrel.entity.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>entity</span></div></a></li><li class="depth-4"><a href="com.borkdal.squirrel.postgresql.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>postgresql</span></div></a></li><li class="depth-5"><a href="com.borkdal.squirrel.postgresql.language-def.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>language-def</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="com.borkdal.squirrel.entity.html#var-declare-entity"><div class="inner"><span>declare-entity</span></div></a></li><li class="depth-1"><a href="com.borkdal.squirrel.entity.html#var-def-entity"><div class="inner"><span>def-entity</span></div></a></li><li class="depth-1"><a href="com.borkdal.squirrel.entity.html#var-def-parent-entity"><div class="inner"><span>def-parent-entity</span></div></a></li><li class="depth-1"><a href="com.borkdal.squirrel.entity.html#var-def-string-entity"><div class="inner"><span>def-string-entity</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">com.borkdal.squirrel.entity</h2><div class="doc"><div class="markdown"></div></div><div class="public anchor" id="var-declare-entity"><h3>declare-entity</h3><h4 class="type">macro</h4><div class="usage"><code>(declare-entity entity)</code></div><div class="doc"><div class="markdown"><p>Declare an entity before its definition, in order to allow circular definitions.</p></div></div></div><div class="public anchor" id="var-def-entity"><h3>def-entity</h3><h4 class="type">macro</h4><div class="usage"><code>(def-entity [var name structure] &amp; body)</code></div><div class="doc"><div class="markdown"><p>Define a new entity.</p><p>Parameters:</p>
<dl><dt>var</dt><dd>The variable used to refer to the entity in the body.</dd><dt>name</dt><dd>The entity name. The name <code>DummyEntity</code> will create functions and macros with the name <code>dummy-entity</code>, as explained below.</dd><dt>structure</dt><dd>A vector of vectors specifying sub-entities.</dd>
</dl><p>Each sub-entity vector has three elements:</p>
<ul>
  <li><p><code>:single</code>, <code>:ordered</code> or <code>:unordered</code>, specifying the number and ordering of instances of this sub-entity.</p></li>
  <li><p>The name of the sub-entity.</p></li>
  <li><p>The variable name used to refer to the sub-entity in the body.</p></li>
</ul>
<dl><dt>body</dt><dd>The code that creates the SQL string for the entity.</dd>
</dl><p>The following are created (given entity name <code>DummyEntity</code>:</p>
<ul>
  <li><p>The record <code>DummyEntity</code>, the type used for instances of the entity. The sub-entities are record fields, with names given by the structure parameters.</p></li>
  <li><p>A method for the generic function <a href="com.borkdal.squirrel.definitions.html#var-record-type">com.borkdal.squirrel.definitions/record-type</a>, giving record type <code>:*ns*/dummy-entity</code>.</p></li>
  <li><p>The function <code>dummy-entity?</code> for checking if a value is an instance of this entity.</p></li>
  <li><p>The function <code>make-dummy-entity</code> for creating an instance of this entity.</p></li>
  <li><p>The function <code>update-dummy-entity</code> for updating an instance of this entity.</p></li>
  <li><p>A method for the generic function <a href="com.borkdal.squirrel.definitions.html#var-add">com.borkdal.squirrel.definitions/add</a>, for adding sub-entities to instances of this entity.</p></li>
  <li><p>The macro <code>dummy-entity</code> for creating instances of this entity.</p></li>
  <li><p>A method for the generic function <a href="com.borkdal.squirrel.definitions.html#var-compile-sql">com.borkdal.squirrel.definitions/compile-sql</a>, for compiling instances of this entity into SQL strings.</p></li>
</ul><p>An example, from <a href="null">com.borkdal.squirrel.postgresql.language</a>:</p>
<pre><code>(entity/def-entity [string-expression
                    StringExpression
                    [[:single ValueExpression expression]]]
  (str &quot;&#39;&quot;
       (defs/compile-sql (:expression string-expression))
       &quot;&#39;&quot;))
</code></pre><p>This specifies an entity called StringExpression, containing a single ValueExpression sub-entity, where the SQL string for the StringExpression is the SQL string for the ValueExpression surrounded by single quotes.</p><p>The following entities are then created:</p>
<ul>
  <li><p>The record <code>StringExpression</code> with the single field <code>expression</code>.</p></li>
  <li><p>Entity methods for <a href="com.borkdal.squirrel.definitions.html#var-record-type">com.borkdal.squirrel.definitions/record-type</a>, <a href="com.borkdal.squirrel.definitions.html#var-add">com.borkdal.squirrel.definitions/add</a> and <a href="com.borkdal.squirrel.definitions.html#var-compile-sql">com.borkdal.squirrel.definitions/compile-sql</a>.</p></li>
  <li><p><a href="null">com.borkdal.squirrel.postgresql.language/string-expression</a></p></li>
  <li><p><a href="null">com.borkdal.squirrel.postgresql.language/string-expression?</a></p></li>
  <li><p><a href="null">com.borkdal.squirrel.postgresql.language/make-string-expression</a></p></li>
  <li><p><a href="null">com.borkdal.squirrel.postgresql.language/update-string-expression</a></p></li>
</ul></div></div></div><div class="public anchor" id="var-def-parent-entity"><h3>def-parent-entity</h3><h4 class="type">macro</h4><div class="usage"><code>(def-parent-entity [parent [&amp; children]])</code></div><div class="doc"><div class="markdown"><p>Define an entity as the parent of children entities.</p><p>The effect of this is that the parent entity can be used in any context where the sub-entities can be used.</p><p>The following is an example from <a href="null">com.borkdal.squirrel.postgresql.language</a>:</p>
<pre><code>(entity/def-parent-entity [Expression [ValueExpression StringExpression]])
</code></pre><p>Values of type <code>ValueExpression</code> and <code>StringExpression</code> can now be used as sub-entities for entities that take <code>Expression</code>, and <a href="null">com.borkdal.squirrel.postgresql.language/expression?</a> will return <code>true</code> for values of type <code>ValueExpression</code> and <code>StringExpression</code>.</p></div></div></div><div class="public anchor" id="var-def-string-entity"><h3>def-string-entity</h3><h4 class="type">macro</h4><div class="usage"><code>(def-string-entity [name entity])</code></div><div class="doc"><div class="markdown"><p>Define an entity that is a simple string.</p><p>All the functions and macros from <a href="com.borkdal.squirrel.entity.html#var-def-entity">def-entity</a> are created.</p><p>The SQL string for the entity is the string itself.</p></div></div></div></div></body></html>